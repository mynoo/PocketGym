<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapMember">
	<!-- 회원 가입하기 -->
	<insert id="insertData" parameterType="AlMember">
		insert into members(id, password, name, nickname, email, gender, height, career, aim_weight, address1, address2, period, birth) 
		values(#{id}, #{password}, #{name}, #{nickname}, #{email}, #{gender}, #{height}, #{career}, #{aim_weight}, #{address1}, #{address2}, #{period}, #{birth})
	</insert>
	
	<select id="selectData" resultType="AlMember">
		select * from members where id = #{id} and password = #{password}
	</select>
	
	<select id="selectById" parameterType="String"
	resultType="AlMember">
	select m.email, m.id, m.password, m.height, m.name, m.nickname, m.address1, m.address2,
	m.gender, m.career, m.period, m.aim_weight, m.ro_id, m.point, r.ro_name
	from members m inner join routines r on m.ro_id = r.ro_id where m.id =
	#{id}
	</select>

	<!-- 회원 최신 몸무게 가져오기 -->
	<select id="selectMyWeight" parameterType="String" resultType="int">
		select weight from myweight where mem_id=#{id} and rownum=1 order by
		weight_id desc
	</select>

	<!-- 회원 정보 수정하기 -->
	<update id="updateMember" parameterType="AlMember">
		update members set email = #{email}, password = #{password}, height =
		#{height}, nickname = #{nickname}, address = #{address}, aim_weight =
		#{aim_weight} where id = #{id}
	</update>
	
	<select id="selectDataID" resultType="AlMember">
      select * from members where id = #{id}
   </select>
   
   <select id="selectDataNickname" resultType="AlMember">
      select * from members where nickname = #{nickname}
   </select>
   
	<select id="selectForOrder" resultType="AlMember">
		select address1, address2, point, nickname from members where id = #{id}
	</select>
   
   <update id="changePoint" parameterType="AlOrder">
		update members set point = point - #{total_price} where id = #{mem_id}
	</update>
   
   <!-- 회원 리스트 개수 출력 -->
   <select id="SelectTotalCount" resultType="int">
		select count(*) as cnt from members
	</select>	
   
   <!-- 모든 회원 정보들 리스트로 출력 -->
   <select id="SelectDataList" resultType="AlMember">
		select*from members
	</select>
   
   <update id="giveRoutine" parameterType="AlMember" >
		update members set ro_id=#{ro_id} where id = #{id}
	</update>
	
	<delete id="DeleteMember" parameterType="String">
		delete from members	where id = #{id}
	</delete>	
	
	
	<!-- 최근 7개의 몸무게 변화 데이터 가져온다 / 부등호를 TAG로 인식하기때문에 <![CDATA[내용]]>으로 묶어준다 -->
	<select id="SelectMyWeightList" resultType="AlWeight">
		<![CDATA[select * from myweight where mem_id=#{id} and rownum <= 7 order by regdate asc]]>
	</select>
	
	<!-- 나의 몸무게 변화 입력 -->
	<insert id="insertMyWeight" parameterType="AlWeight">
		insert into myweight(mem_id, weight, regdate, weight_id) 
		values(#{mem_id}, #{weight}, #{regdate}, myweight_seq.nextval)
	</insert>
	
	
   
</mapper>